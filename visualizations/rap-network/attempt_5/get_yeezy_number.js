artist_nicknames = {"Kanye West" : "Yeezy", "Jay Z" : "Hov", "Kendrick Lamar" : "Kendrick", "Diddy" : "Diddy", "Drake" : "Drizzy", "Lil Wayne" : "Weezy", "Big Sean" : "Big Sean", "Jeezy" : "Jeezy", "Pusha T" : "Pusha", "J. Cole" : "Cole", "Common" : "Common", "2 Chainz" : "2 Chainz", "Nicki Minaj" : "Nicki", "A$AP Ferg" : "Ferg", "Tyler, The Creator" : "Tyler", "Ludacris" : "Luda", "Talib Kweli" : "Talib Kweli", "Cam'ron" : "Killa Cam", "Nas" : "Nas", "KRS-ONE" : "KRS-ONE", "RZA" : "RZA", "T.I." : "T.I.", "Rick Ross" : "Rick Ross", "Lupe Fiasco" : "Lupe", "Yasiin Bey" : "Mos", "Eminem" : "Em", "Raekwon" : "Rae", "Scarface" : "Scarface", "Busta Rhymes" : "Busta", "Chief Keef" : "Keef", "E-40" : "E-40", "Jadakiss" : "Jada", "Future" : "Future", "Ol' Dirty Bastard" : "Dirty", "Frank Ocean" : "Frank Ocean", "Ghostface Killah" : "Ghost", "Twista" : "Twista", "Pete Rock" : "Pete Rock", "Wale" : "Wale", "Ty Dolla $ign" : "Ty Dolla $ign", "Dr. Dre" : "Dre", "The Notorious B.I.G." : "Biggie", "Ja Rule" : "Ja", "Outkast" : "Outkast", "Killer Mike" : "Killer Mike", "DMX" : "DMX", "50 Cent" : "Fitty", "Meek Mill" : "Meek", "Lil Kim" : "Kim", "Kurupt" : "Kurupt", "YG" : "YG", "Nipsey Hu$$le" : "Nipsey", "Birdman" : "Baby", "ScHoolboy Q" : "ScHoolboy Q", "Wiz Khalifa" : "Wiz", "2Pac" : "Pac", "Young Thug" : "Young Thug", "Juicy J" : "Juicy J", "Master P" : "Master P", "Boosie Badazz" : "Boosie", "Rich Homie Quan" : "Rich Homie Quan", "A$AP Rocky" : "Rocky", "Royce Da 5'9\"" : "Royce", "Yelawolf" : "Yelawolf", "Big KRIT" : "KRIT", "Danny Brown" : "Brown", "Action Bronson" : "Action", "Joey BADA$$" : "Joey", "Ab-Soul" : "Soul", "Ace Hood" : "Ace", "Jay Rock" : "Jay Rock", "Tech N9ne" : "Tech", "B.o.B" : "B.o.B.", "Mac Miller" : "Mac", "Snoop Dogg" : "Snoop", "Childish Gambino" : "Gambino", "Curren$y" : "Curren$y", "Murs" : "Murs", "The Roots" : "Roots", "Gucci Mane" : "Gucci", "Logic" : "Logic", "Fat Joe" : "Fat Joe", "LL Cool J" : "Cool J", "Nelly" : "Nelly", "Bone Thugs-n-Harmony" : "Bone Thugs", "Waka Flocka Flame" : "Waka Flocka", "Trey Songz" : "Trey", "Mystikal" : "Mystikal", "Bun B" : "Bun B", "Soulja Boy" : "Soulja Boy", "Krizz Kaliko" : "Krizz", "Lil B" : "Based", "Wyclef Jean" : "Wyclef", "Chance The Rapper" : "Chano", "Kevin Gates" : "Kevin Gates", "Hodgy Beats" : "Hodgy", "Asher Roth" : "Roth", "Ice Cube" : "Ice Cube", "Nate Dogg" : "Nate Dogg", "El-P" : "El-P", "AZ" : "AZ", "Mobb Deep" : "Mobb Deep", "De La Soul" : "De La", "Beastie Boys" : "Beastie", "Xzibit" : "Xzibit", "Kool G. Rap" : "Kool G.", "Inspectah Deck" : "Rebel Ins", "MC Guru" : "Guru", "Freddie Gibbs" : "Gibbs", "Killah Priest" : "Killah Priest", "Method Man" : "Meth", "MF DOOM" : "DOOM", "Cappadonna" : "Cappadonna", "RiFF RAFF" : "RiFF RAFF", "Masta Ace" : "Masta Ace", "Krayzie Bone" : "Krayzie", "Brother Ali" : "Ali", "Redman" : "Reggie", "Outlawz" : "Outlawz", "Ice-T" : "Ice-T", "Three 6 Mafia" : "Three 6", "Ras Kass" : "Ras Kass", "Aesop Rock" : "Aes", "Cunninlynguists" : "Cunninlynguists", "Prince Paul" : "Prince Paul", "Erick Sermon" : "Erick Sermon", "E.P.M.D." : "E.P.M.D.", "Atmosphere" : "Atmosphere", "Rakim" : "Rakim", "A Tribe Called Quest" : "Tribe", "Run-D.M.C." : "D.M.C.", "Eyedea" : "Eyedea", "Cannibal Ox" : "Cannibal Ox", "UGK" : "UGK", "Pimp C" : "Pimp C", "GZA" : "Genius", "Kool Keith" : "Kool Keith", "Das EFX" : "Das EFX", "Gang Starr" : "Gang Starr", "Goodie Mob" : "Goodie Mob", "Cypress Hill" : "Cypress Hill", "Clipse" : "Clipse", "Biz Markie" : "Biz Markie", "Jungle Brothers" : "Jungle Brothers", "Jay Electronica" : "Jay Electronica", "Jeru the Damaja" : "Jeru", "Canibus" : "Canibus", "Earl Sweatshirt" : "Earl", "U-God" : "U-God", "Masta Killa" : "Masta Killa", "Eazy-E" : "Eazy", "Big L" : "Big L", "Lauryn Hill" : "Lauryn Hill", "Big Punisher" : "Big Pun", "Slick Rick" : "Slick Rick", "Public Enemy" : "Public Enemy", "Chuck D" : "Chuck D", "Big Boi" : "Fat Sax", "Andre 3000" : "Andre", "Black Thought" : "Black Thought", "The Underachievers" : "The Underachievers", "Flatbush Zombies" : "Flatbush Zombies", "Capital STEEZ" : "STEEZ", "CJ Fly" : "CJ", "Casey Veggies" : "Veggies", "Big Daddy Kane" : "Kane", "Immortal Technique" : "Technique", "Pharoahe Monch" : "Pharoahe", "MC Lyte" : "MC Lyte", "Kool Moe Dee" : "Kool Moe Dee", "Queen Latifah" : "Latifah", "Beanie Sigel" : "Beanie Sigel", "Domo Genesis" : "Domo", "Game" : "Game", "Rae Sremmurd" : "Rae Sremmurd", "Jedi Mind Tricks"  : "Jedi Mind"}

var fs = require('fs')

/**
 * Basic priority queue implementation. If a better priority queue is wanted/needed,
 * this code works with the implementation in google's closure library (https://code.google.com/p/closure-library/).
 * Use goog.require('goog.structs.PriorityQueue'); and new goog.structs.PriorityQueue()
 */
function PriorityQueue () {
    this._nodes = [];

    this.enqueue = function (priority, key) {
        this._nodes.push({key: key, priority: priority });
        this.sort();
    }
    this.dequeue = function () {
        return this._nodes.shift().key;
    }
    this.sort = function () {
        this._nodes.sort(function (a, b) {
            return a.priority - b.priority;
        });
    }
    this.isEmpty = function () {
        return !this._nodes.length;
    }
}

/**
 * Pathfinding starts here
 */
function Graph(){
    var INFINITY = 1/0;
    this.vertices = {};

    this.addVertex = function(name, edges){
        this.vertices[name] = edges;
    }

    this.shortestPath = function (start, finish) {
        var nodes = new PriorityQueue(),
        distances = {},
        previous = {},
            path = [],
            smallest, vertex, neighbor, alt;

        for(vertex in this.vertices) {
            if(vertex === start) {
                distances[vertex] = 0;
                nodes.enqueue(0, vertex);
            }
            else {
                distances[vertex] = INFINITY;
                nodes.enqueue(INFINITY, vertex);
            }

            previous[vertex] = null;
        }

        while(!nodes.isEmpty()) {
            smallest = nodes.dequeue();

            if(smallest === finish) {
                path;

                while(previous[smallest]) {
                    path.push(smallest);
                    smallest = previous[smallest];
                }

                break;
            }

            if(!smallest || distances[smallest] === INFINITY){
                continue;
            }

            for(neighbor in this.vertices[smallest]) {
                alt = distances[smallest] + this.vertices[smallest][neighbor];

                if(alt < distances[neighbor]) {
                    distances[neighbor] = alt;
                    previous[neighbor] = smallest;

                    nodes.enqueue(alt, neighbor);
                }
            }
        }

        return path;
    }
}


fs.readFile('network_handpicked.json', 'utf8', function (err,data) {
    if (err) {
        return console.log(err);
    }
    data = JSON.parse(data)
    var g = new Graph();
    nodes = data.nodes
    links = data.links

    paths = {}

    edges = {}
    collabs = {}
    for (var i = 0, l = nodes.length; i < l; i ++) {
        var v = nodes[i];
        v["yeezy_number"] = {};
        v["yeezy_path"] = {};
        edges[v.name] = {}
        collabs[v.name] = {}
    }

    for (var i = 0, l = links.length; i < l; i ++) {
        if (links[i].target != null) {
            source = nodes[links[i].source].name
            target = nodes[links[i].target].name
            edges[source][target] = 1
            collabs[source][target] = links[i].songs
            edges[target][source] = 1
            collabs[target][source] = links[i].songs
        }
    }

    for (var artist in edges) {
        g.addVertex(artist, edges[artist])
    }

    artist_centralities = {};
    centralities_frequency = {};

    for (var i = 0, l = nodes.length; i < l; i ++) {
        // Centre the graph at each artist
        var central_artist = nodes[i].name;
        for (var j = 0, l = nodes.length; j < l; j ++) {
            // Find length of path to another artist
            var artist = nodes[j].name;
            path = g.shortestPath(artist, central_artist).reverse()
            path.unshift(artist)

            // Add all steps to get to centre
            path_to_yeezy = []
            for (var step_number = 0, len = path.length - 1; step_number < len; step_number ++) {
                var from = path[step_number];
                var to = path[step_number + 1];
                path_to_yeezy.push({"from":from, "to":to, "song":collabs[from][to][0]})
            }
            nodes[j]["yeezy_number"][central_artist] = path.length - 1
            nodes[j]["yeezy_path"][central_artist] = path_to_yeezy
        }
        sum = 0;
        nodes_included = 0;
        for (var j = 0, l = nodes.length; j < l; j ++) {
            var artist = nodes[j];
            sum += artist["yeezy_number"][central_artist]
            if (artist["yeezy_number"][central_artist] > 0) {
                nodes_included += 1;
            }
        }
        sum = sum/nodes_included;
        artist_centralities[central_artist] = sum;
        if (centralities_frequency[Math.floor(sum*10)/10] == null) {
            centralities_frequency[Math.floor(sum*10)/10] = [central_artist]
        } else {
            centralities_frequency[Math.floor(sum*10)/10].push(central_artist)
        }
        //console.log(central_artist + ": " + sum);
    }
    //console.log(JSON.stringify(artist_centralities));
    console.log(JSON.stringify(centralities_frequency));
    //console.log(JSON.stringify({"nodes":nodes, "links":links}))
});

